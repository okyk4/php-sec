# PHP App ② レビュー

## XSS(クロスサイトスクリプティング)

### XSSとはどんな攻撃か、また攻撃者にどんなメリットがあるか説明してください。

- 概要：Webサイトを閲覧したユーザー環境で、動的Webページの表示内容生成処理の際に任意のスクリプトを紛れ込ませ実行する攻撃

- 攻撃者のメリット：cookie情報を盗み出し、当該のユーザーになりすますことで個人情報やクレジットカード情報等の機密情報を取得することができる

### `htmlspecialchars()`を`e()`として定義しなおすメリットを説明してください。

- 該当の処理を複数回実行する場合にコード全体の文字数を削減することができ、再利用性、保守性、可読性が向上する

### `htmlspecialchars()`を使うことでなぜXSSが防げるのか説明してください。

- システムに影響を与えうる文字列（シングルクォートやダブルクォート等）が別の文字列に変換されるため

## CSRF(クロスサイトリクエストフォージェリ)

### CSRFとはどんな攻撃か、また攻撃者にどんなメリットがあるか説明してください。

- 概要：不特定多数の人に対して、外部のHTMLから意図しないリクエストを送信させる攻撃

- 攻撃者のメリット：ユーザーに身に覚えのない買い物をさせたり、特定のWebサイトに対する信用を失墜させることができる

### SessionとCookieの違いを説明してください。

- Session：データを一時的に保存するサーバ側の領域

- Cookie：データを一時的に保存するブラウザ側の領域

### `setToken()`が何をしているか説明してください。

- `openssl_random_pseudo_bytes(16)`でランダムな16文字のバイト文字列を生成し、生成した文字列を`bin2hex`で16進数に変換したのち、生成された値を`$_SESSION['token']`に格納している

### `checkToken()`が何をしているか説明してください。

- `$_SESSION['token']`に格納されている値が空である場合、または引数の値と一致しない場合に`$_SESSION['err']`の値に「不正な操作です」という文字列を格納し、アクセス元のページへリダイレクトしている

### トークンを使うことでなぜCSRFが防げるのか説明してください。

- 指定のHTMLを表示した際にトークンを発行し、再度リクエストする際にトークンを併せて送信させることで、トークンの整合性を確認してリクエスト元の正しさをチェックできるため

## SQLインジェクション

### SQLインジェクションとはどんな攻撃か、また攻撃者にどんなメリットがあるか説明してください。

- 概要：攻撃側がアプリケーションのセキュリティ上の不備を意図的に利用し、アプリケーションが想定しないSQL文を実行させることで、データベースシステムを不正に操作する攻撃

- 攻撃者のメリット：ユーザーの個人情報やクレジットカード情報等、データベースに保存されている情報を消去したり改ざんすることができる

### `->prepare()`の返り値と、またこのメソッドが何をしているか説明してください。

- 返り値：PDOStatement オブジェクト

- 何をしているか：SQL文を実行する準備をしている

### `->bindValue()`が何をしているか説明してください。

- `$sql`に格納されているSQL文中のプレースホルダー（`:todoText`）に`$todoText`をバインドし、`PDO::PARAM_STR`で文字列型と指定している

### 今回の対策でなぜSQLインジェクションが防げるのか説明してください。

- ユーザーが入力したデータのデータ型を指定し、文字列として認識させるため

## バリデーション

### バリデーションの目的について説明してください。

- ユーザーに制限通りの値を入力させること

### `validate()`が何をしているか説明してください。

- `$post['content']`が存在し、かつその値が空である場合に`$_SESSION['err']`の値に「入力がありません」という文字列を格納し、アクセス元のページへリダイレクトしている

### `isset($post['content'])`はなぜ必要か、無い場合どうなるか説明してください。

- 必要な理由：「削除」実行時、`$post`に格納される配列のキーは`id`と`token`のみであるため、`content`というキーの存在有無を確認して`false`を返すことにより、削除時はif文を経由しないようにするため

- 無い場合：存在しないキー`content`に格納されている値の整合性は測ることが出来ないため、エラーが発生する

## その他

### `unsetError()`を実行しないとどうなるか説明してください。

- `$_SESSION['err']`に格納された文字列が空にならないため、画面遷移後も`$_SESSION['err']`に格納されている文字列が表示され続ける